#!/usr/bin/env python

import os
import argparse
import tkinter as tk
import sys

import simplabel

#Setup parser
ap = argparse.ArgumentParser()
ap.add_argument("-d", "--directory", default=os.getcwd(), help="Path of the directory")
ap.add_argument("-c", "--categories", nargs='+', default=None, help="List of categories")
ap.add_argument("-v", "--verbose", action='store_true', help="Enable verbose mode")
ap.add_argument("-u", "--user", nargs = 1, help="Set username for the current session")
ap.add_argument("-r", "--reconcile", action='store_true', help="Reconcile selections from different users where the labels are different")
ap.add_argument("--reset", action='store_true', help="Deletes any existing data and starts a new labelling task")

args = ap.parse_args()

# Get the variables from parser
rawDirectory = args.directory
categories = args.categories
verbosity = 1 if args.verbose else 0
username = args.user
bReconcile = args.reconcile

# Reset all saved data if requested
if args.reset:
    save_files = [f for f in os.listdir(rawDirectory) if (f.endswith('.pkl') and f.startswith('label'))]
    if len(save_files) > 0:
        response = input("Are you sure you want to delete all saved files: {}? (y/n)".format(save_files))
        if response == 'y':
            for f in save_files:
                os.remove(rawDirectory + '/' + f)
            print("Successfully deleted all saved files")
        else:
            print("Cancelled deletion, your files are exactly where you left them ;)")
    sys.exit(0)

# Launch the app
root = tk.Tk() 
MyApp = simplabel.ImageClassifier(root, rawDirectory, categories, verbosity, username)
tk.mainloop()